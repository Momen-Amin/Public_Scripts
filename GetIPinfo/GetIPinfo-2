#!/bin/bash

# ==============================
#   Server IP Reporter Script
# ==============================

HOSTNAME=$(hostname)
DATE=$(date +"%Y-%m-%d %H:%M:%S")

# ---------- CONFIG ----------
EMAIL_RECIPIENT="momen.amin@hotmail.com"

TELEGRAM_BOT_TOKEN="8538049173:AAFgiUy5Uk3vRXSuxkhiKcbHUWCuHx-HqOQ"
TELEGRAM_CHAT_ID="-5039914012"
# ----------------------------

# Public IP
Public_IP_Address=$(curl -s https://api.ipify.org)

# Collect all interface names + IPv4 Addresses
PRIVATE_IPs=""
for IFACE in $(ls /sys/class/net/); do
    IP_ADDR=$(ip -4 addr show "$IFACE" | grep -oP '(?<=inet\s)\d+(\.\d+){3}')
    if [[ -n "$IP_ADDR" ]]; then
        PRIVATE_IPs+="$IFACE: $IP_ADDR"$'\n'
    fi
done

# Terminal output
echo
echo "======================================="
echo "Server Network Interfaces Information"
echo "======================================="
echo "Hostname: $HOSTNAME"
echo "Date: $DATE"
echo
echo "Public IP: $Public_IP_Address"
echo
echo "Private IPs (with interfaces):"
echo "$private_ips"
echo "======================================="
echo

# ---------- MESSAGE ----------
MESSAGE="ðŸ–¥ Server IP Report

Hostname: $HOSTNAME
Date: $DATE

ðŸŒ Public IP:
$PUBLIC_IP

ðŸ” Private IPs:
$PRIVATE_IPS
"

# ---------- EMAIL ----------
# Email settings
recipient="$EMAIL_RECIPIENT"
subject="[$HOSTNAME] Server Network Interfaces Information"

# Email body
email_body="Server Hostname: ${HOSTNAME}
Date: ${DATE}

Public IP Address:
${Public_IP_Address}

Private IP Addresses (with interface names):
${PRIVATE_IPs}
"
echo -e "$MESSAGE" | mail -s "[$HOSTNAME] Server IP Report" "$EMAIL_RECIPIENT"

# ---------- TELEGRAM ----------
curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
     -d chat_id="${TELEGRAM_CHAT_ID}" \
     -d text="$MESSAGE" \
     -d parse_mode="Markdown" > /dev/null
